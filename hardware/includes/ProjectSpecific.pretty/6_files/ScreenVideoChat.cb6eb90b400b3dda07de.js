(window.webpackJsonp=window.webpackJsonp||[]).push([[73],{1001:function(e,t,i){"use strict";var n;i.d(t,"a",(function(){return n})),function(e){e[e.SCREEN_SHARE=0]="SCREEN_SHARE",e[e.VIDEO_CHAT=1]="VIDEO_CHAT",e[e.NONE=2]="NONE"}(n||(n={}))},11371:function(e,t,i){"use strict";var n=i(0),o=i(180),a=i.n(o),r=i(236),s=i.n(r),c=i(27),d=i(3878),u=i(6),v="ZoomModule",l=u.d(v);u.f(v,(function(){return Promise.all([i.e(18),i.e(86)]).then(i.bind(null,11434)).then((function(e){return e.default}))}));var h=l,p=(i(7703),i(319)),b=i(185),f=i.n(b),g=i(617),D=function(e){function t(t){var i=e.call(this,t)||this;return i.state={providerFacingComponent:void 0,loadedProviderType:void 0},i}return Object(n.d)(t,e),t.prototype.loadProviderModule=function(){return Object(n.b)(this,void 0,void 0,(function(){var e,t,i;return Object(n.e)(this,(function(n){switch(n.label){case 0:e=this.props.providerType,t=void 0,n.label=1;case 1:switch(n.trys.push([1,7,,8]),e){case c.F.OPENTOK:return[3,2];case c.F.ZOOM:return[3,4]}return[3,6];case 2:return[4,Object(d.a)()];case 3:return t=n.sent(),[3,6];case 4:return[4,h()];case 5:return t=n.sent(),[3,6];case 6:return[3,8];case 7:return i=n.sent(),ErrorsTracker.error(new Error("ScreenVideoChatView: provider module load error"),i),this.setState({loadedProviderType:e,providerFacingComponent:void 0}),[3,8];case 8:return t?this.setState({providerFacingComponent:t.providerFacing,loadedProviderType:e}):(ErrorsTracker.error(new Error("ScreenVideoChatView: unknown provider "+e)),this.setState({loadedProviderType:e,providerFacingComponent:void 0})),[2]}}))}))},t.prototype.shouldComponentUpdate=function(e,t,i){e.providerType&&e.providerType!==t.loadedProviderType&&this.loadProviderModule();var n=this.props,o=n.screenSharingState,a=n.sessionState;return t.loadedProviderType!==this.state.loadedProviderType||o!==e.screenSharingState||a!==e.sessionState},t.prototype.componentDidMount=function(){this.loadProviderModule()},t.prototype.render=function(){var e=this.state.providerFacingComponent,t=this.props,i=t.screenSharingState,n=t.sessionState,o=i===c.v.BROADCASTER,r=f()("ss-ui-border-layer",{"ss-ui-border-layer--broadcasting":o,"ss-ui-border-layer--can-broadcast":!o&&n===g.a.JOINED});return a.a.createElement(a.a.Fragment,null,s.a.createPortal(a.a.createElement("div",{className:r}),document.querySelector(".canvas-container")),e?a.a.createElement(e,null):null)},t}(a.a.Component);t.a=Object(p.a)({startPoint:"ui.board.screenvideochat.startPoint",providerType:"ui.board.screenvideochat.videoChatProvider",sessionState:"ui.board.screenvideochat.sessionState",screenSharingState:"ui.board.screenvideochat.screenSharingState"},D)},11421:function(e,t,i){"use strict";i.r(t);var n=i(5),o=i(2937),a=i(7693),r=i(2939),s=i(7697);function c(){return n.a("ScreenVideoChatService")}var d=c(),u=i(7698),v=i(1001),l=i(275),h=i.n(l),p=i(3911),b=i(0),f=i(294),g=i(617),D=i(198),m=i(315),O=i(240),S=i(393),C=i.n(S),_=function(e){return Object(D.b)("toggleVideoChatPanelAction",(function(){C()(e)?Object(O.a)().togglePanelVisibility(m.a.SCREEN_VIDEO_CHAT):Object(O.a)().setPanelVisible(m.a.SCREEN_VIDEO_CHAT,e)}))},y=i(715),E=i(27),j=i(2218),P=i(3437),N=[Object(D.b)("stopBroadcastAction",(function(){d().stopBroadcast(),Object(j.a)().stopSendCursorPosition(P.a.SCREEN_SHARE),Object(j.a)().stopSendViewportPosition(P.a.SCREEN_SHARE)})),Object(f.a)("ui.board.screenvideochat.screenSharingState",E.v.NONE)],A=i(2861);var I=n.a("ScreenShareCursorService"),T=Object(D.b)("stopWatchAction",(function(){A.c(!0),I().hide(),Object(O.a)().setMode(E.g.NORMAL)})),M=[T,Object(f.a)("ui.board.screenvideochat.screenSharingState",E.v.CAN_WATCH)],w=Object(D.b)("disconnectAction",(function(e){var t=e.state.get("ui.board.screenvideochat.sessionState");Object(o.a)().endUpdateState(),t===g.a.JOINED&&d().disconnect()})),B=i(197),R=i(285),V=Object(D.b)("deactivateVideoChatFloatPanelAction",(function(){Object(R.a)().floatingPanels.deactivate(B.a.VIDEO_CHAT_PROVIDERS_MANAGER)})),x=i(532),L=i(318),U=i(184),H=E.F.OPENTOK;function k(e){return Object(b.b)(this,void 0,Promise,(function(){var t,i;return Object(b.e)(this,(function(n){switch(n.label){case 0:({type:H}),n.label=1;case 1:return n.trys.push([1,3,,8]),[4,U.a.boards.selectById(e.id).integration.videoChatProviders.getPrimary()];case 2:return[2,n.sent()];case 3:t=n.sent(),n.label=4;case 4:return n.trys.push([4,6,,7]),[4,U.a.accounts.selectById(e.account.id).integration.videoChatProviders.getPrimary()];case 5:return[2,n.sent()];case 6:throw i=n.sent(),new Error("Board API Error: "+t.toString()+". Account API Error: "+i.toString());case 7:return[3,8];case 8:return[2]}}))}))}var F=Object(D.c)("fetchPrimaryProviderAction",(function(e){var t=e.output,i=e.state;return Object(b.b)(void 0,void 0,void 0,(function(){var e,n;return Object(b.e)(this,(function(o){switch(o.label){case 0:e=i.get("board.info"),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,k(e)];case 2:return n=o.sent(),t.done(n),[3,4];case 3:return o.sent(),t.done({type:H}),[3,4];case 4:return[2]}}))}))})),W=i(707),J=Object(D.b)("initVideoChatParamsAction",(function(e){e.state;Object(o.a)().startUpdateState()})),K=i(4495),q=i(186),z=i(224),G=i(260),Z=i(794),X=i(1909),Y=Object(D.b)("handleVideoChatErrorAction",(function(e){var t=e.input,i=(e.state,t.error),n=!0;i instanceof K.b&&i.provider===E.F.ZOOM&&[K.a.TOKEN_NOT_FOUND,K.a.TOKEN_NOT_VALID].includes(i.modelReason)?(n=!1,Object(q.a)().showError({durationInMS:7e3,text:"Could not start Zoom video chat. Please setup your Zoom account in your Miro account.",actionText:"Go to settings",isError:!0,actionCallback:function(){var e=z.a.getInfo().account,t=e.installedApplications.find((function(e){return e.application.appKey===B.a.ZOOM_VIDEO_CHAT}));t?G.b.teamAppSettings(e.id,t.application.id,void 0,!0):ErrorsTracker.debug("No Zoom inside installedApplications",e.installedApplications)}})):Object(Z.b)().dispatch(Object(X.d)({durationInMS:7e3,text:"Could not start the video chat \u2014 please try to restart it. If the issue persists,",actionText:"send us a bug report.",caption:i instanceof K.b&&i.provider===E.F.ZOOM?"A problem with Zoom video chat":"A problem with video chat"})),n&&ErrorsTracker.error(i)})),Q=i(16),$="IE",ee="NotSafari",te=function(){return!Q.a.ios&&!Q.a.ipados||Q.a.safari?Q.a.msie?$:null:ee},ie=Object(D.c)("toggleAvailabilityAction",(function(e){e.output[null===te()?"done":"fail"]()}),void 0,D.a),ne=[Object(L.a)("startPoint","ui.board.screenvideochat.startPoint"),Object(W.a)("ui.board.screenvideochat.startPoint",{isTrue:v.a.NONE,isFalse:W.a.otherwise}),{isTrue:[Object(f.a)("ui.board.screenvideochat.sessionState",g.a.CAN_JOIN)],isFalse:[Object(f.a)("ui.board.screenvideochat.sessionState",g.a.CAN_START)]},F,{done:[Object(L.a)("type","ui.board.screenvideochat.videoChatProvider"),J],fail:[Y]},ie,{done:[_(!0)],fail:[_(!1)]}],oe=Object(D.b)("setDisconnectReasonAction",(function(e){var t=e.input,i=e.state,n=t.reason;n&&i.set("ui.board.screenvideochat.disconnectReason",n)})),ae=[oe,Object(y.a)("ui.board.screenvideochat.screenSharingState",(function(e){return e===E.v.BROADCASTER})),{true:N,false:[Object(y.a)("ui.board.screenvideochat.screenSharingState",(function(e){return e===E.v.WATCHER})),{true:M,false:[]}]},w,V,Object(f.a)("ui.board.screenvideochat.screenSharePluginSwitchedOn",!1),Object(f.a)("ui.board.screenvideochat.videoChatPluginSwitchedOn",!1),Object(f.a)("ui.board.screenvideochat.sessionState",g.a.IDLE),Object(f.a)("ui.board.screenvideochat.startPoint",v.a.NONE),Object(f.a)("ui.board.screenvideochat.canJoinVideoChat",!1),Object(f.a)("ui.board.screenvideochat.videoChatProvider",void 0),Object(f.a)("ui.board.screenvideochat.videoChatProviderOptions",void 0),Object(y.a)("ui.board.screenvideochat.participants",(function(e){return!!e.length})),{true:Object(b.j)([Object(x.a)({startPoint:v.a.NONE})],ne),false:[_(!1)]}],re=[Object(D.b)("connectAction",(function(){d().connect()})),Object(f.a)("ui.board.screenvideochat.sessionState",g.a.JOINED),Object(f.a)("ui.board.screenvideochat.disconnectReason",void 0)],se=Object(D.b)("isCanScreenShareAction",(function(e){var t=e.state,i=e.output,n=t.get("ui.board.screenvideochat.sessionState"),o=t.get("ui.board.screenvideochat.screenSharingState");n===g.a.JOINED?o===E.v.CAN_WATCH?i.isWatcher():o===E.v.NONE?i.isBroadcaster():i.isFalse():i.isFalse()})),ce=i(181),de=[Object(D.b)("startWatchAction",(function(){A.c(!1),ce.mySelection.clearSelection(),I().show(),Object(O.a)().setMode(E.g.SCREEN_WATCHING)})),Object(f.a)("ui.board.screenvideochat.screenSharingState",E.v.WATCHER)],ue=i(540),ve=Object(D.c)("getParticipantAction",(function(e){var t=e.input,i=e.output;return Object(b.b)(void 0,void 0,void 0,(function(){var e,n,o;return Object(b.e)(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),e=t.clientId,[4,Object(ue.a)().getUserInfo(e)];case 1:return n=a.sent(),i.done({participant:{clientId:e,userInfo:n}}),[3,3];case 2:return o=a.sent(),i.fail({error:o}),[3,3];case 3:return[2]}}))}))})),le=[ve,{done:[Object(L.a)("participant","ui.board.screenvideochat.broadcaster"),Object(f.a)("ui.board.screenvideochat.screenSharingState",E.v.CAN_WATCH),se,{isBroadcaster:[],isWatcher:de,isFalse:[]}],fail:[]}],he=[Object(D.b)("startBroadcastAction",(function(){d().startBroadcast(),Object(j.a)().startSendCursorPosition(P.a.SCREEN_SHARE),Object(j.a)().startSendViewportPosition(P.a.SCREEN_SHARE)})),Object(f.a)("ui.board.screenvideochat.screenSharingState",E.v.BROADCASTER)],pe=i(2938),be=i(188),fe=i.n(be),ge=Object(D.b)("updateViewportAction",(function(e){var t=e.input,i=e.state,n=i.get("ui.board.screenvideochat.sessionState"),o=i.get("ui.board.screenvideochat.screenSharingState");if(n===g.a.JOINED&&o===E.v.WATCHER){var a=t.x0,r=t.y0,s=t.x1,c=t.y1,d=new fe.a.Rectangle(a,r,s-a,c-r);ce.canvasActions.jumpToViewport(d,100)}})),De=Object(D.b)("updateCursorAction",(function(e){var t=e.input,i=e.state,n=i.get("ui.board.screenvideochat.sessionState"),o=i.get("ui.board.screenvideochat.screenSharingState"),a=t.x,r=t.y;n===g.a.JOINED&&o===E.v.WATCHER&&I().updateCursorPosition(a,r)})),me=[T,Object(f.a)("ui.board.screenvideochat.broadcaster",void 0),Object(f.a)("ui.board.screenvideochat.screenSharingState",E.v.NONE)],Oe=Object(D.b)("pushParticipantAction",(function(e){var t=e.input,i=e.state,n=i.get("ui.board.screenvideochat.participants"),o=t.participant;n.some((function(e){return o.clientId===e.clientId}))||i.set("ui.board.screenvideochat.participants",n.concat(o))})),Se=i(559),Ce=i(606),_e=i(179),ye=i(319),Ee=i(2074),je=i(2715),Pe=(i(7700),Object(ye.a)({startPoint:"ui.board.screenvideochat.startPoint",sessionState:"ui.board.screenvideochat.sessionState",participantCount:"ui.board.screenvideochat.participantCount"},(function(e){var t=e.initiatorName,n=e.sessionName,o=e.participantCount,a=e.sessionState,r=e.startPoint,s=e.onHide,c=e.onJoinClick,d=e.errorMessage,u=e.hideFooter;return _e.d.useEffect((function(){r!==v.a.NONE?s(Ce.a.PLUGIN,je.a.VIDEO_CHAT_PANEL_ACTIVATED):a!==g.a.CAN_JOIN&&s(Ce.a.PLUGIN,je.a.SESSION_ENDED)}),[a,r,s]),_e.d.createElement(Ee.a,{icon:_e.d.createElement("svg",{className:"screen-video-chat-toast__circle-icon",role:"none"},_e.d.createElement("use",{xlinkHref:i(3809)})),title:"Videochat",subTitle:_e.d.createElement("span",{className:"screen-video-chat-toast__subtitle"},_e.d.createElement("svg",{className:"screen-video-chat-toast__user-icon",role:"none"},_e.d.createElement("use",{xlinkHref:i(3544)})),o),message:_e.d.createElement("span",null,_e.d.createElement("strong",null,t)," ","has started a "+n),errorMessage:d,footer:u?null:_e.d.createElement(_e.f.Button,{hmTap:c,className:"rtb-btn rtb-btn--primary rtb-btn--small"},"Join")})}))),Ne=i(1054),Ae=Object(D.b)("showScreenVideoChatToast",(function(e){var t,i,n,o=e.state,a=void 0,r=o.get("ui.board.screenvideochat.participants"),s=o.get("ui.board.screenvideochat.screenSharingState"),c=null!==(n=null===(i=null===(t=r[0])||void 0===t?void 0:t.userInfo)||void 0===i?void 0:i.name)&&void 0!==n?n:"",d=s===E.v.CAN_WATCH?"screen sharing session":"video chat session",u=function(e){return e===E.v.CAN_WATCH?je.b.SCREEN_SHARING_STARTED:je.b.VIDEOCHAT_STARTED}(s),v=function(){var e;switch(te()){case $:e="Video chat is not supported on Internet Explorer. Please use a different browser.";break;case ee:e="Video chat is currently only available on Safari."}return e}(),l=function(e,t){C()(a)||Object(Se.a)().hide(a,{source:e,action:t})};a=Object(Se.a)().show({component:Pe,passProps:{initiatorName:c,sessionName:d,onHide:l,onJoinClick:function(){var e=o.get("ui.board.screenvideochat.screenSharingState"),t=o.get("ui.board.screenvideochat.screenSharePluginSwitchedOn"),i=o.get("ui.board.screenvideochat.videoChatPluginSwitchedOn");Ne.a.getSignals().ui.board.screenvideochat.joinSession(),Ne.a.getSignals().ui.board.screenvideochat.prepareVideoChat(),e===E.v.CAN_WATCH&&Ne.a.getSignals().ui.board.screenvideochat.startWatch(),t||i||Ne.a.getSignals().ui.board.screenvideochat.screenSharePluginSwitched(),l(Ce.a.USER,je.a.ACTION_BUTTON_CLICKED)},errorMessage:v,hideFooter:!!v},dataAutotestId:"videochat-toast",onHide:function(e){var t=e.source,i=e.action;Object(je.h)({notification_id:u,source:t,action:i})}}),Object(je.i)({notification_id:u,action:je.a.SESSION_STARTED})})),Ie=[ve,{done:[Oe,Object(y.a)("ui.board.screenvideochat.sessionState",(function(e){return e===g.a.IDLE})),{true:Object(b.j)([Object(x.a)({startPoint:v.a.NONE})],ne,[Object(y.a)("ui.board.screenvideochat.videoChatProvider",(function(e){return e===E.F.OPENTOK})),{true:[Object(y.a)("ui.board.screenvideochat.sessionState",(function(e){return e===g.a.CAN_JOIN})),{true:[Ae],false:[]}],false:[]}]),false:[]}],fail:[]}],Te=[Object(D.b)("removeParticipantAction",(function(e){var t=e.input,i=e.state,n=i.get("ui.board.screenvideochat.participants");i.set("ui.board.screenvideochat.participants",n.filter((function(e){return e.clientId!==t.clientId})))})),Object(y.a)("ui.board.screenvideochat.participants",(function(e){return 0===e.length})),{true:[Object(y.a)("ui.board.screenvideochat.sessionState",(function(e){return e===g.a.CAN_JOIN})),{true:[Object(y.a)("ui.board.screenvideochat.startPoint",(function(e){return e===v.a.NONE})),{true:ae,false:[Object(f.a)("ui.board.screenvideochat.sessionState",g.a.CAN_START)]}],false:[]}],false:[]}],Me=i(1884),we=Object(D.b)("updateMediaDevicesStateAction",(function(e){var t=e.input,i=e.state,n=i.get("ui.board.screenvideochat.videoDevices"),o=i.get("ui.board.screenvideochat.audioDevices"),a=t.cameraState,r=t.micState,s=t.videoDevices,c=t.audioDevices,d=t.selectedAudio,u=t.selectedVideo;C()(a)||i.set("ui.board.screenvideochat.cameraState",a),C()(r)||i.set("ui.board.screenvideochat.micState",r),Object(Me.b)(n,s)||i.set("ui.board.screenvideochat.videoDevices",s),Object(Me.b)(o,c)||i.set("ui.board.screenvideochat.audioDevices",c),i.set("ui.board.screenvideochat.selectedAudio",d),i.set("ui.board.screenvideochat.selectedVideo",u)})),Be=Object(D.b)("activateVideoChatFloatPanelAction",(function(){Object(R.a)().floatingPanels.activate(B.a.VIDEO_CHAT_PROVIDERS_MANAGER,E.k.RIGHT)})),Re=[Object(D.c)("requestVideoChatOptionsAction",(function(e){var t=e.output,i=e.state.get("ui.board.screenvideochat.videoChatProvider");Object(r.a)().initSession(i).then((function(e){t.done({options:e})})).catch((function(e){t.fail({error:e})}))})),{done:[Object(L.a)("options","ui.board.screenvideochat.videoChatProviderOptions"),Be,Object(f.a)("ui.board.screenvideochat.canJoinVideoChat",!0)],fail:[Y,Object(f.a)("ui.board.screenvideochat.videoChatProviderOptions",void 0),V,Object(f.a)("ui.board.screenvideochat.canJoinVideoChat",!1)]}],Ve=i(1448),xe=[Object(Ve.a)("ui.board.screenvideochat.screenSharePluginSwitchedOn"),Object(f.a)("ui.board.screenvideochat.videoChatPluginSwitchedOn",!1),Object(y.a)("ui.board.screenvideochat.screenSharePluginSwitchedOn"),{true:[Object(y.a)("ui.board.screenvideochat.sessionState",(function(e){return e===g.a.IDLE})),{true:Object(b.j)([Object(x.a)({startPoint:v.a.SCREEN_SHARE})],ne),false:[Object(y.a)("ui.board.screenvideochat.sessionState",(function(e){return e!==g.a.JOINED})),{true:[Object(f.a)("ui.board.screenvideochat.startPoint",v.a.SCREEN_SHARE)],false:[]}]}],false:[Object(y.a)("ui.board.screenvideochat.sessionState",(function(e){return e===g.a.CAN_START})),{true:ae,false:[]}]}],Le=[Object(Ve.a)("ui.board.screenvideochat.videoChatPluginSwitchedOn"),Object(f.a)("ui.board.screenvideochat.screenSharePluginSwitchedOn",!1),Object(y.a)("ui.board.screenvideochat.videoChatPluginSwitchedOn"),{true:[Object(y.a)("ui.board.screenvideochat.sessionState",(function(e){return e===g.a.IDLE})),{true:Object(b.j)([Object(x.a)({startPoint:v.a.VIDEO_CHAT})],ne),false:[Object(y.a)("ui.board.screenvideochat.sessionState",(function(e){return e!==g.a.JOINED})),{true:[Object(f.a)("ui.board.screenvideochat.startPoint",v.a.VIDEO_CHAT)],false:[]}]}],false:[Object(y.a)("ui.board.screenvideochat.sessionState",(function(e){return e===g.a.CAN_START})),{true:ae,false:[]}]}],Ue=[oe,Object(y.a)("ui.board.screenvideochat.screenSharingState",(function(e){return e===E.v.BROADCASTER})),{true:N,false:[Object(y.a)("ui.board.screenvideochat.screenSharingState",(function(e){return e===E.v.WATCHER})),{true:M,false:[]}]},w,V,Object(f.a)("ui.board.screenvideochat.screenSharePluginSwitchedOn",!1),Object(f.a)("ui.board.screenvideochat.videoChatPluginSwitchedOn",!1),Object(f.a)("ui.board.screenvideochat.sessionState",g.a.IDLE),Object(f.a)("ui.board.screenvideochat.startPoint",v.a.NONE),Object(f.a)("ui.board.screenvideochat.canJoinVideoChat",!1),Object(f.a)("ui.board.screenvideochat.videoChatProvider",void 0),Object(f.a)("ui.board.screenvideochat.videoChatProviderOptions",void 0),Object(f.a)("ui.board.screenvideochat.screenSharingState",E.v.NONE),Object(f.a)("ui.board.screenvideochat.participants",[]),Object(f.a)("ui.board.screenvideochat.broadcaster",void 0)],He=i(1910),ke=i.n(He).a.monkey({cursors:{participants:"ui.board.screenvideochat.participants".split(".")},get:function(e){return e.participants.length}}),Fe=[Object(D.b)("providerTerminateSessionAction",(function(){r.c()().providerSessionTerminated()}))];function We(e){return function(t){var i=e.getModuleState(),n={screenSharePluginSwitchedOn:!1,videoChatPluginSwitchedOn:!1,sessionState:g.a.IDLE,startPoint:v.a.NONE,screenSharingState:E.v.NONE,broadcaster:void 0,participants:[],videoChatProvider:void 0,cameraState:pe.a.UNKNOWN,micState:pe.a.UNKNOWN,videoDevices:[],audioDevices:[],selectedAudio:null,selectedVideo:null,canJoinVideoChat:!1,videoChatProviderOptions:void 0,participantCount:ke,disconnectReason:void 0};t.addState(h()({},n,i)),t.addSignals({screenSharePluginSwitched:xe,videoChatPluginSwitched:Le,sessionLost:Ue,joinSession:re,leaveSession:ae,broadcastStarted:le,broadcastStopped:me,participantConnected:Ie,participantDisconnected:Te,startBroadcast:he,stopBroadcast:N,startWatch:de,stopWatch:M,viewportUpdated:[ge],broadcasterCursorUpdated:[De],mediaDevicesUpdated:[we],prepareVideoChat:[Re],providerSessionTerminated:Fe})}}var Je=i(335),Ke=i.n(Je),qe=i(389),ze=i(192),Ge=function(){function e(){var e=this;this.onCanvasLoaded=function(){e.cursorContainer=new fe.a.DisplayObjectContainer,ce.canvasLayers.addLayer("ScreenShareCursorLayer",e.cursorContainer,qe.a.SCREEN_SHARE_CURSOR,!0,!1,!1),e.createCursor()},ce.doOnCanvasLoaded(this.onCanvasLoaded)}return e.prototype.createCursor=function(){this.cursorVisual=new fe.a.Graphics,this.cursorVisual.beginFill(0,1),this.cursorVisual.lineStyle(1,0,1),this.cursorVisual.moveTo(0,0),this.cursorVisual.lineTo(6,16),this.cursorVisual.lineTo(16,6),this.cursorVisual.lineTo(0,0),this.cursorVisual.moveTo(10,12),this.cursorVisual.lineTo(17,19),this.cursorVisual.lineTo(19,17),this.cursorVisual.lineTo(12,10),this.cursorVisual.lineTo(10,12),this.cursorVisual.endFill(),this.cursorVisual.scale=.8,this.cursorVisual.visible=!1,this.cursorContainer.addChild(this.cursorVisual)},e.prototype.updateCursorPosition=function(e,t){this.desiredPosition=new fe.a.Point(ze.q(e),ze.r(t)),this.animationStartTime=Date.now(),this.startPosition=this.cursorVisual.position,this.animate()},e.prototype.show=function(){this.cursorVisual.visible=!0},e.prototype.hide=function(){this.cursorVisual.visible=!1},e.prototype.animate=function(){var e=this;Ke()(this.desiredPosition,this.cursorVisual.position)||requestAnimationFrame((function(){var t=(Date.now()-e.animationStartTime)/1e3;t>0&&t<1?(e.cursorVisual.x+=(e.desiredPosition.x-e.startPosition.x)*t,e.cursorVisual.y+=(e.desiredPosition.y-e.startPosition.y)*t,e.animate()):t>=1&&(e.cursorVisual.x=e.desiredPosition.x,e.cursorVisual.y=e.desiredPosition.y)}))},e}(),Ze=i(190),Xe=i(182),Ye=i(7702);function Qe(){return Object(Ze.a)({restrict:"E",template:i(7705)})}var $e=i(3878),et=i(222),tt=i.n(et),it=i(4222),nt=i(4225),ot=i(1193),at=i(316);!function(){var e=p.a,t=e.observer;e.module.addModules({screenvideochat:We(t.getObserverForModule("screenvideochat"))})}(),n.c(o.b(),new a.a),n.c(r.d(),new s.a),n.c("ScreenVideoChatService",new u.a),n.c("ScreenShareCursorService",new Ge),Object(Ye.a)(),Object(Xe.b)().directive("screenVideoChatBottomPanel",Qe);var rt=tt()((function(){Object(R.a)().bottomBar.listUpdated.dispatch()}),200);function st(e){return void 0===e}var ct=function(){function e(){var e=this;this.screenVideoChatService=c()(),this.videoChatService=r.b()(),this.__cameraModel=n.a("ScreenVideoChatService")(),this.__videoChatModel=r.c()();var t=at.a.getModel().tree.select("ui.board.screenvideochat.screenSharingState".split(".")),i=at.a.getModel().tree.select("ui.board.screenvideochat.sessionState".split(".")),o=at.a.getModel().tree.select("ui.board.screenvideochat.participants".split(".")),a=at.a.getModel().tree.select("ui.board.screenvideochat.screenSharePluginSwitchedOn".split(".")),s=at.a.getModel().tree.select("ui.board.screenvideochat.videoChatPluginSwitchedOn".split("."));t.on("update",this.onScreenSharingStateChanged),i.on("update",this.onScreenVideoChatSessionStateChanged),o.on("update",this.onParticipantsCountChanged),a.on("update",rt),s.on("update",rt),$e.b.add((function(e){return ot.e.dispatch(e)})),nt.b&&this.__cameraModel.onCameraModelReady(nt.b),nt.a.add((function(t){t?e.__cameraModel.onCameraModelReady(t):e.__cameraModel.clearCameraModel()})),it.c&&this.__videoChatModel.onVideoChatModelReady(it.c),it.b.add((function(t){t?e.__videoChatModel.onVideoChatModelReady(t):e.__videoChatModel.clearVideoChatModel()})),ce.onScopeDestroyed.add((function(){e.__cameraModel.clearCameraModel(),e.__videoChatModel.clearVideoChatModel()}))}return e.prototype.onScreenSharingStateChanged=function(e){var t,i,n=null===(t=null===e||void 0===e?void 0:e.data)||void 0===t?void 0:t.previousData,o=null===(i=null===e||void 0===e?void 0:e.data)||void 0===i?void 0:i.currentData;st(n)||st(o)||ot.d.dispatch(o),rt()},e.prototype.onScreenVideoChatSessionStateChanged=function(e){var t,i=null===(t=null===e||void 0===e?void 0:e.data)||void 0===t?void 0:t.currentData;st(i)||ot.c.dispatch(i),rt()},e.prototype.onParticipantsCountChanged=function(e){var t,i=null===(t=null===e||void 0===e?void 0:e.data)||void 0===t?void 0:t.currentData;st(i)||ot.b.dispatch(i)},e}();t.default=new ct},1448:function(e,t,i){"use strict";t.a=function(e,t,i){return void 0===t&&(t=!0),void 0===i&&(i=!1),function(n){var o=n.state,a=o.get(e);o.set(e,a===t?i:t)}}},1455:function(e,t,i){var n=i(2168);"string"===typeof n&&(n=[[e.i,n,""]]);var o={hmr:!0,transform:undefined,insertInto:void 0};i(178)(n,o);n.locals&&(e.exports=n.locals)},1701:function(e,t,i){"use strict";var n=i(184),o=i(198),a=Object(o.c)("switchStarredState",(function(e){var t,i=e.input,o=e.output;i.starred?(t=n.a.boards.selectById(i.boardId).unfavorite(),i.callback(!1)):(t=n.a.boards.selectById(i.boardId).favorite(),i.callback(!0)),t.then((function(){o.done()}),(function(){o.fail()}))}),{boardId:String,starred:Boolean,callback:Function},["done","fail"]);t.a=a},1884:function(e,t,i){"use strict";i.d(t,"c",(function(){return c})),i.d(t,"e",(function(){return d})),i.d(t,"f",(function(){return u})),i.d(t,"g",(function(){return v})),i.d(t,"d",(function(){return l})),i.d(t,"b",(function(){return h})),i.d(t,"a",(function(){return n}));var n,o=i(2938),a=i(617),r=i(1001),s=function(e,t){return e===a.a.CAN_START&&t===r.a.VIDEO_CHAT},c=function(e){return e===o.a.ALLOWED},d=function(e,t,i,n){return!!c(t)&&(e&&(i===a.a.JOINED||s(i,n)))},u=function(e,t,i){return c(e)&&s(t,i)},v=function(e){return[o.a.UNKNOWN,o.a.NEED_ASK,o.a.NO_DEVICE].includes(e)},l=function(e){return[o.a.UNSUPPORTED,o.a.BLOCKED].includes(e)},h=function(e,t){if(e.length===t.length){var i=e.map((function(e){return e.deviceId})),n=t.map((function(e){return e.deviceId}));return new Set(i.concat(n)).size===i.length}return!1};!function(e){e.MICROPHONE="microphone",e.CAMERA="camera"}(n||(n={}))},2074:function(e,t,i){"use strict";i.d(t,"b",(function(){return m})),i.d(t,"a",(function(){return l}));var n=i(179),o=i(606),a=i(559),r=i(0),s=(i(2164),i(522)),c=i(16),d=function(e){var t=e.onClose,i=e.onClick,o=e.dataAutotestId,a=e.children,r=c.a.isTouchSupported;return n.d.createElement(n.f.Div,{hmTap:i,className:Object(n.i)("toast",{"toast--with-touch":r}),dataAutoTestId:o},n.d.createElement(s.a,{onClose:t,type:s.c.SECONDARY_DARK,className:Object(n.i)("toast__close-btn",{"toast__close-btn--with-touch":r}),dataAutotestId:"toast__close-btn",active:r}),a)},u=i(805),v=i.n(u),l=(i(2166),function(e){var t=e.icon,i=e.title,o=e.subTitle,a=e.message,s=e.errorMessage,c=e.footer;return n.d.createElement(n.d.Fragment,null,n.d.createElement("div",{className:"toast-content__header"},t?n.d.cloneElement(t,Object(r.a)(Object(r.a)({},t.props),{className:Object(n.i)("toast-content__icon",t.props.className)})):null,v()(i)?null:n.d.createElement("span",{className:"toast-content__title","data-autotest-id":"toast__title"},i),v()(o)?null:n.d.createElement("span",{className:"toast-content__subtitle"},o)),v()(a)?null:n.d.createElement("div",{className:"toast-content__message"},a),v()(s)?null:n.d.createElement("div",{className:"toast-content__message toast-content__message--error"},s),v()(c)?null:n.d.createElement("div",{className:"toast-content__footer"},c))}),h=n.d.memo((function(e){var t,i,o=e.toast,a=e.onClose,s=n.d.useCallback((function(e){return e.stopPropagation(),a(o.id),o.onClose&&o.onClose()}),[o,a]);return"component"in o?(t=o.component,i=o.passProps):(t=l,i={icon:o.icon,title:o.title,subTitle:o.subTitle,message:o.message,footer:o.footer,dataAutotestId:o.dataAutotestId}),n.d.createElement(d,{onClick:o.onClick,onClose:s,dataAutotestId:o.dataAutotestId},n.d.createElement(t,Object(r.a)({},i)))})),p=(i(1455),function(e){for(var t=e.toasts,i=e.onClose,o=e.className,a=[],r=t.length-1;r>=0;r--){var s=t[r];a.push(n.d.createElement(n.a,{key:s.id,timeout:400,classNames:"toast-list__animation"},n.d.createElement(h,{toast:s,onClose:i})))}return n.d.createElement(n.g,{className:Object(n.i)("toast-list",o),"data-autotest-id":"toast-list"},a)}),b=n.d.useState,f=n.d.useEffect,g=n.d.useCallback,D={source:o.a.USER,action:"close_button_clicked"},m=n.d.memo((function(e){var t=e.className,i=b(Object(a.a)().getAll()),o=i[0],r=i[1];f((function(){var e=function(){return r(Object(a.a)().getAll())};return Object(a.a)().toastsChanged.add(e),function(){Object(a.a)().toastsChanged.remove(e)}}),[]);var s=g((function(e){Object(a.a)().hide(e,D)}),[]);return n.d.createElement(p,{toasts:o,onClose:s,className:t})}))},2164:function(e,t,i){var n=i(2165);"string"===typeof n&&(n=[[e.i,n,""]]);var o={hmr:!0,transform:undefined,insertInto:void 0};i(178)(n,o);n.locals&&(e.exports=n.locals)},2165:function(e,t,i){(e.exports=i(177)(!1)).push([e.i,".toast {\n  position: relative;\n  padding: 14px 16px;\n  overflow: hidden;\n  background-color: rgba(9, 9, 9, 1);\n  background-color: var(--black);\n  color: rgba(255, 255, 255, 1);\n  color: var(--white);\n  border-radius: 8px;\n  border-radius: var(--radiusL);\n  margin-bottom: 6px;\n}\n.toast .toast-content__subtitle {\n  pointer-events: all;\n  opacity: 1;\n  transition: all 0.15s cubic-bezier(0.2, 0.3, 0.25, 0.9);\n}\n.toast:hover .toast__close-btn {\n  pointer-events: all;\n  opacity: 1;\n  transition: all 0.15s cubic-bezier(0.2, 0.3, 0.25, 0.9);\n}\n.toast:hover .toast-content__subtitle {\n  pointer-events: none;\n  opacity: 0;\n  transition: all 0.15s cubic-bezier(0.2, 0.3, 0.25, 0.9);\n}\n.toast--with-touch .toast-content__subtitle {\n  display: none;\n}\n.toast__close-btn {\n  pointer-events: none;\n  opacity: 0;\n  transition: all 0.15s cubic-bezier(0.2, 0.3, 0.25, 0.9);\n  position: absolute;\n  top: 6px;\n  right: 6px;\n}\n.toast__close-btn--with-touch {\n  pointer-events: all;\n  opacity: 1;\n  transition: all 0.15s cubic-bezier(0.2, 0.3, 0.25, 0.9);\n}\n.toast__close-icon {\n  width: 16px;\n  height: 16px;\n}\n.toast__close-icon path {\n  color: currentColor;\n}\n",""])},2166:function(e,t,i){var n=i(2167);"string"===typeof n&&(n=[[e.i,n,""]]);var o={hmr:!0,transform:undefined,insertInto:void 0};i(178)(n,o);n.locals&&(e.exports=n.locals)},2167:function(e,t,i){(e.exports=i(177)(!1)).push([e.i,".toast-content__header {\n  font-family: Formular, sans-serif;\n  min-height: 16px;\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-align: center;\n      align-items: center;\n  margin-bottom: 8px;\n}\n.toast-content__title {\n  font-size: 12px;\n  line-height: 1em;\n  letter-spacing: 0.03em;\n  font-weight: bold;\n  color: #808080;\n  text-transform: uppercase;\n}\n.toast-content__icon {\n  width: 12px;\n  height: 12px;\n  margin-right: 8px;\n}\n.toast-content__subtitle {\n  margin-left: auto;\n  text-align: right;\n  font-size: 12px;\n  line-height: 1em;\n  letter-spacing: 0.03em;\n  font-weight: bold;\n  text-transform: uppercase;\n}\n.toast-content__message {\n  font-style: normal;\n  font-stretch: normal;\n  letter-spacing: normal;\n  font-size: 14px;\n  line-height: 20px;\n  font-weight: normal;\n}\n.toast-content__message--error {\n  font-style: normal;\n  font-stretch: normal;\n  letter-spacing: normal;\n  font-size: 12px;\n  line-height: 18px;\n  font-weight: normal;\n  line-height: 16px;\n  color: #ff6575;\n}\n.toast-content__message + .toast-content__message--error {\n  margin-top: 10px;\n}\n.toast-content__footer {\n  margin-top: 14px;\n}\n",""])},2168:function(e,t,i){(e.exports=i(177)(!1)).push([e.i,".toast-list {\n  position: absolute;\n  right: 0;\n  top: 16px;\n  z-index: 1000;\n  bottom: auto;\n  width: 268px;\n  max-width: calc(100vw - 16px * 2);\n  margin-right: 16px;\n}\n.toast-list__animation-enter {\n  opacity: 0;\n  transform: translateX(100%);\n}\n.toast-list__animation-enter-active {\n  opacity: 1;\n  transform: translateX(0);\n  transition: opacity 400ms ease, transform 400ms ease;\n}\n.toast-list__animation-exit {\n  opacity: 1;\n}\n.toast-list__animation-exit-active {\n  opacity: 0;\n  transition: opacity 400ms;\n}\n",""])},2715:function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"a",(function(){return o})),i.d(t,"d",(function(){return u})),i.d(t,"e",(function(){return v})),i.d(t,"g",(function(){return l})),i.d(t,"f",(function(){return h})),i.d(t,"i",(function(){return p})),i.d(t,"h",(function(){return b})),i.d(t,"c",(function(){return f}));var n,o,a=i(0),r=i(42),s=i(1054),c="videochat";function d(e,t){Object(r.a)().sendApiEvent(e,Object(a.a)(Object(a.a)({},function(){var e=s.a.getState().ui.board.screenvideochat.screenSharingState,t=s.a.getState().ui.board.screenvideochat.participants;return{screenshare:e,unique_participants:(null===t||void 0===t?void 0:t.length)||0}}()),t))}function u(e){d("stream_user_joined",e)}function v(e){d("stream_user_left",e)}function l(e){d("stream_user_property_changed",e)}function h(e){d("stream_user_meeting_started",e)}function p(e){var t;Object(r.a)().sendApiEvent("toast_notification_shown",Object(a.a)(Object(a.a)({},e),{plugin:c,action:null!==(t=e.action)&&void 0!==t?t:""}))}function b(e){var t;Object(r.a)().sendApiEvent("toast_notification_hidden",Object(a.a)(Object(a.a)({},e),{plugin:c,action:null!==(t=e.action)&&void 0!==t?t:""}))}function f(e){d("stream_user_session_dissonnect",e)}!function(e){e.SCREEN_SHARING_STARTED="screen_sharing_started",e.VIDEOCHAT_STARTED="videochat_started"}(n||(n={})),function(e){e.SESSION_STARTED="session_started",e.SESSION_ENDED="session_ended",e.ACTION_BUTTON_CLICKED="action_button_clicked",e.VIDEO_CHAT_PANEL_ACTIVATED="video_chat_panel_activated"}(o||(o={}))},2937:function(e,t,i){"use strict";i.d(t,"b",(function(){return o}));var n=i(5);function o(){return"MediaDevicesService"}t.a=n.a("MediaDevicesService")},2938:function(e,t,i){"use strict";var n;!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.BLOCKED=1]="BLOCKED",e[e.UNSUPPORTED=2]="UNSUPPORTED",e[e.NO_DEVICE=3]="NO_DEVICE",e[e.ALLOWED=4]="ALLOWED",e[e.NEED_ASK=5]="NEED_ASK"}(n||(n={})),t.a=n},2939:function(e,t,i){"use strict";i.d(t,"d",(function(){return o})),i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return r}));var n=i(5);function o(){return"VideoChatService"}function a(){return n.a("VideoChatService")}function r(){return n.a("VideoChatService")}t.a=a()},3544:function(e,t){e.exports="#img__rtb-user"},3809:function(e,t){e.exports="#img__rtb-circle-solid"},3877:function(e,t,i){"use strict";var n=i(0),o=function(){function e(e){this.onDeviceChanged=e.onDeviceChanged,this.onPermissionChanged=e.onPermissionChanged}return e.prototype.loadDevices=function(){return Object(n.b)(this,void 0,void 0,(function(){var e,t;return Object(n.e)(this,(function(i){switch(i.label){case 0:e=[],t=[],i.label=1;case 1:return i.trys.push([1,3,,4]),[4,navigator.mediaDevices.enumerateDevices()];case 2:return i.sent().forEach((function(i){i.deviceId&&("audioinput"===i.kind?e.push(i.toJSON()):"videoinput"===i.kind&&t.push(i.toJSON()))})),[3,4];case 3:return i.sent(),[3,4];case 4:return[2,{videoDevices:t,audioDevices:e}]}}))}))},e.prototype.onStart=function(){return Promise.resolve()},e.prototype.onStop=function(){return Promise.resolve()},e.prototype.requestPermissions=function(e){return Object(n.b)(this,void 0,Promise,(function(){return Object(n.e)(this,(function(t){switch(t.label){case 0:return[4,navigator.mediaDevices.getUserMedia(e)];case 1:return t.sent().getTracks().forEach((function(e){return e.stop()})),[2]}}))}))},e}();t.a=o},3878:function(e,t,i){"use strict";(function(e){i.d(t,"b",(function(){return r}));var n=i(6),o="OpenTokModule",a=n.d(o);n.f(o,(function(){return Promise.all([i.e(18),i.e(67)]).then(i.bind(null,11276)).then((function(e){return e.default}))}));var r=new e.Signal;t.a=a}).call(this,i(110))},3911:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return l}));var n,o=i(198),a=Object(o.b)("toggleBottomBar",(function(e){var t=e.state;t.set("ui.board.bottomBarCollapsed",!t.get("ui.board.bottomBarCollapsed"))})),r=Object(o.b)("collapseBottomBar",(function(e){e.state.set("ui.board.bottomBarCollapsed",!0)})),s=[function(e){var t=e.input,i=e.state;(0,e.output)({boardId:t.boardId,starred:i.get("board.info.starred"),callback:t.callback})},i(1701).a,{done:[function(e){var t=e.state;t.set("board.info.starred",!t.get("board.info.starred"))}],fail:[]}],c=i(1290),d=Object(o.b)("setTemplateID",(function(e){var t=e.state,i=e.input;t.set("ui.board.addedTemplate.templateId",i.templateId)})),u=Object(o.b)("setWidgetsIDs",(function(e){var t=e.state,i=e.input;t.set("ui.board.addedTemplate.setWidgetsIDs",i.setWidgetsIDs)}));function v(e){return function(t){e.addPaths(["bottomBarCollapsed","addedTemplate"]);var i=e.getModuleState();t.addState(Object.assign({bottomBarCollapsed:!1},i)),t.addSignals({bottomBarToggled:[a],bottomBarCollapsed:[r],boardStarred:s}),t.addModules({addedTemplate:function(e){e.addState({templateId:"",setWidgetsIDs:""}),e.addSignals({setTemplateID:[d],setWidgetsIDs:[u]})}}),n={observer:e,module:t}}}function l(){var e=c.b(),t=e.observer;e.module.addModules({board:v(t.getObserverForModule("board"))})}},4495:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var n,o=i(0);!function(e){e.FORBIDDEN="FORBIDDEN",e.OTHER_PROVIDER="OHTER_PROVIDER",e.UNKNOWN_PROVIDER="UNKNOWN_PROVIDER",e.TOKEN_NOT_FOUND="TOKEN_NOT_FOUND",e.TOKEN_NOT_VALID="TOKEN_NOT_VALID",e.UNEXPECTED="UNEXPECTED"}(n||(n={}));var a=function(e){function t(t,i,n){var o=this.constructor;void 0===t&&(t="Could not start video chat. Please try to restart it.");var a=e.call(this,t)||this;return Object.setPrototypeOf(a,o.prototype),a.name="VideoChatError",a.modelReason=i,a.provider=n,a}return Object(o.d)(t,e),t.prototype.toString=function(){return e.prototype.toString.call(this)+"."+(this.modelReason||"")},t}(Error);t.b=a},532:function(e,t,i){"use strict";t.a=function(e){return function(t){(0,t.output)(e)}}},617:function(e,t,i){"use strict";var n;!function(e){e[e.IDLE=0]="IDLE",e[e.CAN_START=1]="CAN_START",e[e.CAN_JOIN=2]="CAN_JOIN",e[e.JOINED=3]="JOINED"}(n||(n={})),t.a=n},707:function(e,t,i){"use strict";function n(){}var o=function(e,t,i){void 0===t&&(t={isTrue:!0,isFalse:n}),void 0===i&&(i=!0);var o=function(o){var a=o.state,r=o.output,s=a.get(e);i&&s&&"object"===typeof s&&0===Object.keys(s).length&&(s=!1);var c=null,d=null;Object.keys(t).forEach((function(e){s==t[e]&&(c=e),t[e]==n&&(d=e)})),r[c||d]()};return o.displayName="when",o.outputs=Object.keys(t),o};o.otherwise=n,t.a=o},7693:function(e,t,i){"use strict";(function(e,n){var o=i(0),a=i(2938),r=i(1296),s=i(27),c=i(1054),d=i(368),u=i(191),v=i(242),l=i(1884),h=i(7694),p=i(7695),b=i(7696),f=i(16),g="mediaDevices",D=function(){function t(){this.deviceChanged=new e.Signal,this.audioDeviceState=a.a.UNKNOWN,this.videoDeviceState=a.a.UNKNOWN,this._audioDevices=[],this._videoDevices=[],this._selectedAudio=null,this._selectedVideo=null,this.userSettings={},navigator.mediaDevices||(this.audioDeviceState=a.a.UNSUPPORTED,this.videoDeviceState=a.a.UNSUPPORTED),this.loadUserSettings(),this.setBrowserBridge()}return Object.defineProperty(t.prototype,"updateStarted",{get:function(){return this._updateStarted},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"audioDevices",{get:function(){return this._audioDevices},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoDevices",{get:function(){return this._videoDevices},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selectedAudio",{get:function(){return this._selectedAudio},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selectedVideo",{get:function(){return this._selectedVideo},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"audioState",{get:function(){return this.audioDeviceState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoState",{get:function(){return this.videoDeviceState},enumerable:!1,configurable:!0}),t.prototype.setBrowserBridge=function(){var e,t=Object(r.b)()!==s.c.DESKTOP_APP&&"permissions"in navigator;e=!t||f.a.webkit||f.a.safari?p.a:f.a.firefox||f.a.gecko?b.a:(f.a.chrome||f.a.opera||f.a.msedge||f.a.yandexbrowser)&&t?h.a:p.a,this.browserBridge=new e({onPermissionChanged:this.onBridgePermissionChanged,onDeviceChanged:this.onBridgeDeviceChanged})},t.prototype.onBridgePermissionChanged=function(e,t){return Object(o.b)(this,void 0,void 0,(function(){var i;return Object(o.e)(this,(function(o){switch(o.label){case 0:switch(n.log("mediaDevices","onBridgePermissionChanged",{name:e,state:t}),i=this.getMediaStateByPermissionState(t),e){case l.a.CAMERA:this.videoDeviceState=i;break;case l.a.MICROPHONE:this.audioDeviceState=i}return[4,this.updateMediaDevicesState()];case 1:return o.sent(),[2]}}))}))},t.prototype.onBridgeDeviceChanged=function(){return Object(o.b)(this,void 0,void 0,(function(){return Object(o.e)(this,(function(e){switch(e.label){case 0:return n.log("mediaDevices","onBridgeDeviceChanged"),[4,this.updateMediaDevicesState()];case 1:return e.sent(),[2]}}))}))},t.prototype.getUserSettings=function(){var e=v.getItem(g);if(e)try{return JSON.parse(e)}catch(e){}return{}},t.prototype.saveUserSettings=function(e){this.userSettings.selectedAudioDevice===e.selectedAudioDevice&&this.userSettings.selectedVideoDevice===e.selectedVideoDevice||(this.userSettings=e,v.setItem(g,JSON.stringify(e)))},t.prototype.loadUserSettings=function(){this.userSettings=this.getUserSettings()},t.prototype.updateMediaDevicesState=function(){return Object(o.b)(this,void 0,void 0,(function(){return Object(o.e)(this,(function(e){switch(e.label){case 0:return[4,this.updateDevicesList()];case 1:return e.sent(),this.setupDefaultDevices(),this.onDeviceChanged(),[2]}}))}))},t.prototype.getUserMediaDevices=function(){var e,t,i=this.userSettings,n=i.selectedAudioDevice,o=i.selectedVideoDevice;return n&&(e=this.audioDevices.find((function(e){return e.deviceId===n}))),o&&(t=this.videoDevices.find((function(e){return e.deviceId===o}))),{audioDevice:e,videoDevice:t}},t.prototype.setupDefaultDevices=function(){var e=this.getUserMediaDevices(),t=this.audioDevices[0],i=this.videoDevices[0];this._selectedAudio=e.audioDevice||t||null,this._selectedVideo=e.videoDevice||i||null,n.log("mediaDevices","setupDefaultDevices",{selectedAudio:this._selectedAudio,selectedVideo:this._selectedVideo})},t.prototype.startUpdateState=function(){return Object(o.b)(this,void 0,void 0,(function(){return Object(o.e)(this,(function(e){switch(e.label){case 0:return this.updateStarted||!navigator.mediaDevices?[3,4]:(n.log("mediaDevices","updateStarted"),n.log("mediaDevices","currentState",{audioState:a.a[this.audioDeviceState],videoState:a.a[this.videoDeviceState]}),this._updateStarted=!0,[4,this.browserBridge.onStart()]);case 1:return e.sent(),[4,this.updateDevicesList()];case 2:return e.sent(),[4,this.updateDeviceState()];case 3:e.sent(),this.setupDefaultDevices(),this.onDeviceChanged(),this.browserBridge.observeDevices(),e.label=4;case 4:return[2]}}))}))},t.prototype.endUpdateState=function(){return Object(o.b)(this,void 0,void 0,(function(){return Object(o.e)(this,(function(e){switch(e.label){case 0:return this.updateStarted?(n.log("mediaDevices","updateEnded"),this._updateStarted=!1,[4,this.browserBridge.onStop()]):[3,2];case 1:e.sent(),this.browserBridge.clearDeviceObservers(),e.label=2;case 2:return[2]}}))}))},t.prototype.setAudioDevice=function(e){this._selectedAudio=e,this.onDeviceChanged()},t.prototype.setVideoDevice=function(e){this._selectedVideo=e,this.onDeviceChanged()},t.prototype.updateDevicesList=function(){return Object(o.b)(this,void 0,void 0,(function(){var e;return Object(o.e)(this,(function(t){switch(t.label){case 0:return[4,this.browserBridge.getMediaDevices()];case 1:return e=t.sent(),n.log("mediaDevices","updateDevicesList",{availableMediaDevices:e}),this._audioDevices=e.audioDevices,this._videoDevices=e.videoDevices,this.onDeviceChanged(),[2]}}))}))},t.prototype.updateDeviceState=function(){return Object(o.b)(this,void 0,void 0,(function(){var e,t,i;return Object(o.e)(this,(function(o){switch(o.label){case 0:return[4,this.browserBridge.getMediaDevicePermissions()];case 1:return e=o.sent(),t=this.getMediaStateByPermissionState(e.audioState),i=this.getMediaStateByPermissionState(e.videoState),n.log("mediaDevices","updateDeviceState",{permissionsState:e,audioState:t,videoState:i}),t===this.audioDeviceState&&i===this.videoDeviceState||(this.audioDeviceState=t,this.videoDeviceState=i,this.onDeviceChanged()),[2]}}))}))},t.prototype.getMediaStateByPermissionState=function(e){switch(e){case"denied":return a.a.BLOCKED;case"granted":return a.a.ALLOWED;case"prompt":case void 0:return a.a.NEED_ASK}},t.prototype.requestMedia=function(e){return Object(o.b)(this,void 0,Promise,(function(){var t,i,n;return Object(o.e)(this,(function(o){switch(o.label){case 0:return t=void 0!==(null===e||void 0===e?void 0:e.audio)?e.audio:!Object(l.d)(this.audioDeviceState),i=void 0!==(null===e||void 0===e?void 0:e.video)?e.video:!Object(l.d)(this.videoDeviceState),[4,this.requestByPermissions({audio:t,video:i})];case 1:return n=o.sent(),t&&(this.audioDeviceState=n),i&&(this.videoDeviceState=n),[4,this.updateMediaDevicesState()];case 2:return o.sent(),[2,{audio:this.audioDeviceState===a.a.ALLOWED,video:this.videoDeviceState===a.a.ALLOWED}]}}))}))},t.prototype.requestByPermissions=function(e){return Object(o.b)(this,void 0,Promise,(function(){var t;return Object(o.e)(this,(function(i){switch(i.label){case 0:t=a.a.BLOCKED,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.browserBridge.requestPermissions(e)];case 2:return i.sent(),t=a.a.ALLOWED,[3,4];case 3:return i.sent().message.includes("dismissed")&&(t=a.a.NEED_ASK),[3,4];case 4:return n.log("mediaDevices","requestByPermissions",{permissions:e,status:t}),[2,t]}}))}))},t.prototype.onDeviceChanged=function(){var e,t;n.log("mediaDevices","deviceChanged",{audioState:a.a[this.audioDeviceState],videoState:a.a[this.videoDeviceState],audioDevices:this._audioDevices,videoDevices:this._videoDevices,selectedAudio:this._selectedAudio,selectedVideo:this._selectedVideo}),c.a.getSignals().ui.board.screenvideochat.mediaDevicesUpdated({cameraState:this.videoDeviceState,micState:this.audioDeviceState,audioDevices:this._audioDevices,videoDevices:this._videoDevices,selectedAudio:this._selectedAudio,selectedVideo:this._selectedVideo}),this.saveUserSettings({selectedAudioDevice:null===(e=this._selectedAudio)||void 0===e?void 0:e.deviceId,selectedVideoDevice:null===(t=this._selectedVideo)||void 0===t?void 0:t.deviceId}),this.deviceChanged.dispatch()},Object(o.c)([u.a],t.prototype,"onBridgePermissionChanged",null),Object(o.c)([u.a],t.prototype,"onBridgeDeviceChanged",null),Object(o.c)([Object(d.a)(100)],t.prototype,"onDeviceChanged",null),t}();t.a=D}).call(this,i(110),i(54))},7694:function(e,t,i){"use strict";(function(e){var n=i(0),o=i(3877),a=i(1884),r=i(191),s=(function(){function e(){}e.prototype.addEventListener=function(e,t){},e.prototype.removeEventListener=function(e,t){}}(),function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.permissionsObservers=new Map,e}return Object(n.d)(i,t),i.prototype.addDevicePermissionObserver=function(t){var i=this;navigator.permissions.query({name:t}).then((function(n){var o=function(){e.log("mediaDevices","ChromiumMediaDeviceBridge::onPermissionChanged"),i.onPermissionChanged(t,n.state)};n.addEventListener("change",o),i.permissionsObservers.set(n,o)}))},i.prototype.getPermissionState=function(e){return Object(n.b)(this,void 0,Promise,(function(){var t,i;return Object(n.e)(this,(function(n){switch(n.label){case 0:t="prompt",n.label=1;case 1:return n.trys.push([1,3,,4]),[4,navigator.permissions.query({name:e})];case 2:return i=n.sent(),t=i.state,[3,4];case 3:return n.sent(),[3,4];case 4:return[2,t]}}))}))},i.prototype.deviceChanged=function(){e.log("mediaDevices","ChromiumMediaDeviceBridge::deviceChanged"),this.onDeviceChanged()},i.prototype.startDeviceChangeObserver=function(){e.log("mediaDevices","ChromiumMediaDeviceBridge::startDeviceChangeObserver"),navigator.mediaDevices.addEventListener("devicechange",this.deviceChanged)},i.prototype.clearDeviceChangeObserver=function(){e.log("mediaDevices","ChromiumMediaDeviceBridge::clearDeviceChangeObserver"),navigator.mediaDevices.removeEventListener("devicechange",this.deviceChanged)},i.prototype.onStart=function(){return Object(n.b)(this,void 0,Promise,(function(){var t,i,o;return Object(n.e)(this,(function(n){switch(n.label){case 0:return e.log("mediaDevices","ChromiumMediaDeviceBridge::onStart"),[4,this.getMediaDevicePermissions()];case 1:if(t=n.sent(),i=t.audioState,o=t.videoState,"granted"===i&&"granted"===o)return[3,5];n.label=2;case 2:return n.trys.push([2,4,,5]),[4,this.requestPermissions({audio:"denied"!==i,video:"denied"!==o})];case 3:return n.sent(),[3,5];case 4:return n.sent(),[3,5];case 5:return[2]}}))}))},i.prototype.observeDevices=function(){e.log("mediaDevices","ChromiumMediaDeviceBridge::observeDevices"),this.addDevicePermissionObserver(a.a.MICROPHONE),this.addDevicePermissionObserver(a.a.CAMERA),this.startDeviceChangeObserver()},i.prototype.clearDeviceObservers=function(){e.log("mediaDevices","ChromiumMediaDeviceBridge::clearDevicePermissionObservers"),this.permissionsObservers.forEach((function(e,t){t.removeEventListener("change",e)})),this.permissionsObservers.clear(),this.clearDeviceChangeObserver()},i.prototype.getMediaDevicePermissions=function(){return Object(n.b)(this,void 0,void 0,(function(){var t,i,o;return Object(n.e)(this,(function(n){switch(n.label){case 0:return[4,this.getPermissionState(a.a.MICROPHONE)];case 1:return t=n.sent(),[4,this.getPermissionState(a.a.CAMERA)];case 2:return i=n.sent(),o={audioState:t,videoState:i},e.log("mediaDevices","ChromiumMediaDeviceBridge::getMediaDevicePermissions",{deviceStates:o}),[2,o]}}))}))},i.prototype.getMediaDevices=function(){return Object(n.b)(this,void 0,void 0,(function(){var t;return Object(n.e)(this,(function(i){return t=this.loadDevices(),e.log("mediaDevices","ChromiumMediaDeviceBridge::getMediaDevices",{devices:t}),[2,t]}))}))},Object(n.c)([r.a],i.prototype,"deviceChanged",null),i}(o.a));t.a=s}).call(this,i(54))},7695:function(e,t,i){"use strict";(function(e){var n=i(0),o=i(1884),a=i(3877),r=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e._videoDevices=[],e._audioDevices=[],e}return Object(n.d)(i,t),Object.defineProperty(i.prototype,"requestPermissionParam",{get:function(){return{audio:"denied"!==this._audioDevicePermission,video:"denied"!==this._videoDevicePermission}},enumerable:!1,configurable:!0}),i.prototype.updateMediaDevicesInfo=function(){return Object(n.b)(this,void 0,void 0,(function(){var t,i,o,a,r;return Object(n.e)(this,(function(n){switch(n.label){case 0:return[4,this.loadDevices()];case 1:return t=n.sent(),i=t.audioDevices[0],o=t.videoDevices[0],a=this.getMediaDeviceState(i),r=this.getMediaDeviceState(o),e.log("mediaDevices","OldBrowsersMediaDeviceBridge::updateMediaDevicesInfo",{mediaDevices:t,audioState:a,videoState:r}),this._audioDevices=t.audioDevices,this._videoDevices=t.videoDevices,this._audioDevicePermission=a,this._videoDevicePermission=r,[2]}}))}))},i.prototype.intervalMediaDeviceChecker=function(){return Object(n.b)(this,void 0,void 0,(function(){var t;return Object(n.e)(this,(function(i){switch(i.label){case 0:return[4,this.loadDevices()];case 1:return t=i.sent(),e.log("mediaDevices","OldBrowsersMediaDeviceBridge::intervalMediaDeviceChecker",{mediaDevices:t}),this.checkDeviceChanges(t),this.checkDevicePermission(t),[2]}}))}))},i.prototype.checkDeviceChanges=function(t){Object(o.b)(this._audioDevices,t.audioDevices)&&Object(o.b)(this._videoDevices,t.videoDevices)||(this._audioDevices=t.audioDevices,this._videoDevices=t.videoDevices,e.log("mediaDevices","OldBrowsersMediaDeviceBridge::onDeviceChanged",{mediaDevices:t}),this.onDeviceChanged())},i.prototype.checkDevicePermission=function(t){var i=t.audioDevices[0],n=t.videoDevices[0],a=this.getMediaDeviceState(i),r=this.getMediaDeviceState(n);a!==this._audioDevicePermission&&(this._audioDevicePermission=a,e.log("mediaDevices","OldBrowsersMediaDeviceBridge::onPermissionChanged",{audioState:a}),this.onPermissionChanged(o.a.MICROPHONE,a)),r!==this._videoDevicePermission&&(this._videoDevicePermission=r,e.log("mediaDevices","OldBrowsersMediaDeviceBridge::onPermissionChanged",{videoState:r}),this.onPermissionChanged(o.a.CAMERA,r))},i.prototype.getMediaDeviceState=function(e){return e?this.getMediaStateByLabel(e.label):"denied"},i.prototype.getMediaStateByLabel=function(e){return e?"granted":"prompt"},i.prototype.onStart=function(){return Object(n.b)(this,void 0,Promise,(function(){var t;return Object(n.e)(this,(function(i){switch(i.label){case 0:if(e.log("mediaDevices","OldBrowsersMediaDeviceBridge::onStart"),"granted"===this._audioDevicePermission&&"granted"===this._videoDevicePermission)return[3,5];i.label=1;case 1:return i.trys.push([1,4,,5]),[4,this.requestPermissions(this.requestPermissionParam)];case 2:return i.sent(),[4,this.updateMediaDevicesInfo()];case 3:return i.sent(),[3,5];case 4:return t=i.sent(),console.error(t),ErrorsTracker.error(t),[3,5];case 5:return[2]}}))}))},i.prototype.observeDevices=function(){var t=this;e.log("mediaDevices","OldBrowsersMediaDeviceBridge::observeDevices"),this.intervalId=setInterval((function(){return t.intervalMediaDeviceChecker()}),1e3)},i.prototype.clearDeviceObservers=function(){e.log("mediaDevices","OldBrowsersMediaDeviceBridge::clearDeviceObservers"),clearInterval(this.intervalId),this.intervalId=void 0},i.prototype.getMediaDevicePermissions=function(){return Object(n.b)(this,void 0,void 0,(function(){var t,i,o,a,r;return Object(n.e)(this,(function(n){switch(n.label){case 0:return[4,this.getMediaDevices()];case 1:return t=n.sent(),i=t.audioDevices[0],o=t.videoDevices[0],[4,this.getMediaDeviceState(i)];case 2:return a=n.sent(),[4,this.getMediaDeviceState(o)];case 3:return r=n.sent(),e.log("mediaDevices","OldBrowsersMediaDeviceBridge::getMediaDevicePermissions",{mediaDevices:t,audioState:a,videoState:r}),[2,{audioState:a,videoState:r}]}}))}))},i.prototype.getMediaDevices=function(){return Object(n.b)(this,void 0,void 0,(function(){var t,i,o;return Object(n.e)(this,(function(n){switch(n.label){case 0:return[4,this.loadDevices()];case 1:return t=n.sent(),i=t.audioDevices,o=t.videoDevices,this._audioDevices=i,this._videoDevices=o,e.log("mediaDevices","OldBrowsersMediaDeviceBridge::getMediaDevices",{audioDevices:i,videoDevices:o}),[2,{audioDevices:i,videoDevices:o}]}}))}))},i}(a.a);t.a=r}).call(this,i(54))},7696:function(e,t,i){"use strict";(function(e){var n=i(0),o=i(1884),a=i(3877),r=i(191),s=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e._videoDevices=[],e._audioDevices=[],e._deviceLabels=new Map,e}return Object(n.d)(i,t),i.prototype.getMediaDeviceState=function(e){return e?this.getMediaStateByLabel(e.label):"denied"},i.prototype.getMediaStateByLabel=function(e){return e?"granted":"prompt"},Object.defineProperty(i.prototype,"requestPermissionParam",{get:function(){return{audio:"denied"!==this._audioDevicePermission,video:"denied"!==this._videoDevicePermission}},enumerable:!1,configurable:!0}),i.prototype.onUpdateDevices=function(){return Object(n.b)(this,void 0,void 0,(function(){var t,i,o,a,r,s;return Object(n.e)(this,(function(n){switch(n.label){case 0:return e.log("mediaDevices","FirefoxMediaDeviceBridge::onUpdateDevices"),[4,this.loadCompleteDevicesInfo()];case 1:return t=n.sent(),i=t.audioDevices.some((function(e){return!e.label})),o=t.videoDevices.some((function(e){return!e.label})),i||o?[4,this.loadDeviceInternal({audio:i,video:o})]:[3,3];case 2:t=n.sent(),n.label=3;case 3:return a=this.getDevicePermissions(t),r=a.audioState,s=a.videoState,t=this.needToClearAudioDevices(r,t),t=this.needToClearVideoDevices(s,t),this.needToUpdateAudioPermissions(r),this.needToUpdateVideoPermissions(s),this.needToUpdateDevices(t),[2]}}))}))},i.prototype.needToClearAudioDevices=function(e,t){return"denied"!==e&&"prompt"!==e||(this.clearDevicesLabels(t.audioDevices),t.audioDevices=[]),t},i.prototype.needToClearVideoDevices=function(e,t){return"denied"!==e&&"prompt"!==e||(this.clearDevicesLabels(t.videoDevices),t.videoDevices=[]),t},i.prototype.needToUpdateAudioPermissions=function(t){t!==this._audioDevicePermission&&(this._audioDevicePermission=t,e.log("mediaDevices","FirefoxMediaDeviceBridge::onPermissionChanged",{audioState:t}),this.onPermissionChanged(o.a.MICROPHONE,t))},i.prototype.needToUpdateVideoPermissions=function(t){t!==this._videoDevicePermission&&(this._videoDevicePermission=t,e.log("mediaDevices","FirefoxMediaDeviceBridge::onPermissionChanged",{videoState:t}),this.onPermissionChanged(o.a.CAMERA,t))},i.prototype.needToUpdateDevices=function(t){Object(o.b)(this._audioDevices,t.audioDevices)&&Object(o.b)(this._videoDevices,t.videoDevices)||(this._audioDevices=t.audioDevices,this._videoDevices=t.videoDevices,e.log("mediaDevices","FirefoxMediaDeviceBridge::onDeviceChanged",t),this.onDeviceChanged())},i.prototype.intervalChecker=function(){var e=this;this.intervalPromise||(this.intervalPromise=this.onUpdateDevices(),this.intervalPromise.finally((function(){e.intervalPromise=null})))},i.prototype.startDeviceChangeObserver=function(){var t=this;e.log("mediaDevices","FirefoxMediaDeviceBridge::startDeviceChangeObserver"),this.intervalId=setInterval((function(){return t.intervalChecker()}),1e3)},i.prototype.clearDeviceChangeObserver=function(){e.log("mediaDevices","FirefoxMediaDeviceBridge::clearDeviceChangeObserver"),clearInterval(this.intervalId),this.intervalId=void 0},i.prototype.getTestedDevice=function(e){return e.reduce((function(e,t){return e&&t.label?e:t}),void 0)},i.prototype.getDevicePermissions=function(t){var i=this.getTestedDevice(t.audioDevices),n=this.getTestedDevice(t.videoDevices),o={audioState:this.getMediaDeviceState(i),videoState:this.getMediaDeviceState(n)};return e.log("mediaDevices","FirefoxMediaDeviceBridge::getDevicePermissions",{permissions:o}),o},i.prototype.getUniqueId=function(e){return e.deviceId+"::"+e.kind},i.prototype.clearDevicesLabels=function(e){var t=this;e.forEach((function(e){t._deviceLabels.delete(t.getUniqueId(e))}))},i.prototype.updateDeviceLabel=function(t){var i=this.getUniqueId(t),n=this._deviceLabels.get(i);n&&!t.label?(t.label=n,e.log("mediaDevices","FirefoxMediaDeviceBridge::setLabel",{device:t})):!n&&t.label&&(this._deviceLabels.set(i,t.label),e.log("mediaDevices","FirefoxMediaDeviceBridge::addLabel",{device:t}))},i.prototype.updateDevicesLabels=function(e){var t=this;e.audioDevices.forEach((function(e){t.updateDeviceLabel(e)})),e.videoDevices.forEach((function(e){t.updateDeviceLabel(e)}))},i.prototype.loadCompleteDevicesInfo=function(){return Object(n.b)(this,void 0,void 0,(function(){var e;return Object(n.e)(this,(function(t){switch(t.label){case 0:return[4,this.loadDevices()];case 1:return e=t.sent(),this.updateDevicesLabels(e),[2,e]}}))}))},i.prototype.loadDeviceInternal=function(t,i){return void 0===i&&(i=!1),Object(n.b)(this,void 0,void 0,(function(){var o,a,r;return Object(n.e)(this,(function(n){switch(n.label){case 0:o={audioDevices:[],videoDevices:[]},n.label=1;case 1:return n.trys.push([1,4,,6]),[4,navigator.mediaDevices.getUserMedia(t)];case 2:return a=n.sent(),[4,this.loadCompleteDevicesInfo()];case 3:return o=n.sent(),a.getTracks().forEach((function(e){return e.stop()})),[3,6];case 4:if(r=n.sent(),i)throw r;return[4,this.loadCompleteDevicesInfo()];case 5:return o=n.sent(),[3,6];case 6:return e.log("mediaDevices","FirefoxMediaDeviceBridge::loadDeviceInternal",{mediaDevices:o,permissions:t}),[2,o]}}))}))},i.prototype.updateMediaDevicesInfo=function(t,i){return Object(n.b)(this,void 0,void 0,(function(){var o,a,r,s;return Object(n.e)(this,(function(n){switch(n.label){case 0:return[4,this.loadDeviceInternal(t,i)];case 1:return o=n.sent(),a=this.getDevicePermissions(o),r=a.audioState,s=a.videoState,e.log("mediaDevices","FirefoxMediaDeviceBridge::updateMediaDevicesInfo",{devices:o,audioState:r,videoState:s}),this._audioDevices=o.audioDevices,this._videoDevices=o.videoDevices,this._audioDevicePermission=r,this._videoDevicePermission=s,[2]}}))}))},i.prototype.onStart=function(){return Object(n.b)(this,void 0,Promise,(function(){return Object(n.e)(this,(function(t){switch(t.label){case 0:return e.log("mediaDevices","FirefoxMediaDeviceBridge::onStart"),"granted"===this._audioDevicePermission&&"granted"===this._videoDevicePermission?[3,2]:[4,this.updateMediaDevicesInfo(this.requestPermissionParam)];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},i.prototype.requestPermissions=function(e){return this.updateMediaDevicesInfo(e,!0)},i.prototype.observeDevices=function(){e.log("mediaDevices","FirefoxMediaDeviceBridge::observeDevices"),this.startDeviceChangeObserver()},i.prototype.clearDeviceObservers=function(){e.log("mediaDevices","FirefoxMediaDeviceBridge::clearDeviceChangeObserver"),this.clearDeviceChangeObserver()},i.prototype.getMediaDevicePermissions=function(){var t={audioState:this._audioDevicePermission,videoState:this._videoDevicePermission};return e.log("mediaDevices","FirefoxMediaDeviceBridge::getMediaDevicePermissions",t),Promise.resolve(t)},i.prototype.getMediaDevices=function(){var t={audioDevices:this._audioDevices,videoDevices:this._videoDevices};return e.log("mediaDevices","FirefoxMediaDeviceBridge::getMediaDevices"),Promise.resolve(t)},Object(n.c)([r.a],i.prototype,"onUpdateDevices",null),Object(n.c)([r.a],i.prototype,"intervalChecker",null),i}(a.a);t.a=s}).call(this,i(54))},7697:function(e,t,i){"use strict";(function(e){var n=i(4224),o=i(4495),a=new n.a,r=function(){function t(){this.model=a,this.reconnectNeeded=new e.Signal}return t.prototype.onVideoChatModelReady=function(e){this.model=e},t.prototype.clearVideoChatModel=function(){this.model=a},t.prototype.initSession=function(e){var t=this;if(this.videoChatSession)return this.videoChatSession.joinPromise;var i=new Promise((function(n,o){t.videoChatSession={joinPromise:i,joinResolve:n,joinReject:o,providerType:e},t.model.initSession(e)}));return this.videoChatSession.joinPromise=i,i},t.prototype.initSessionSucceeded=function(e){if(!this.videoChatSession)throw new o.b("Unexpected session initialization");this.videoChatSession.joinResolve(e),this.videoChatSession=void 0},t.prototype.initSessionFailed=function(e){if(!this.videoChatSession)throw new o.b("Unexpected session initialization");this.videoChatSession.joinReject(new o.b("Init session failed",e,this.videoChatSession.providerType)),this.videoChatSession=void 0},t.prototype.leave=function(){var e;null===(e=this.model)||void 0===e||e.leave()},t.prototype.providerSessionTerminated=function(){var e;null===(e=this.model)||void 0===e||e.sessionDisconnected()},t.prototype.reconnect=function(){this.reconnectNeeded.dispatch()},t}();t.a=r}).call(this,i(110))},7698:function(e,t,i){"use strict";(function(e,n){var o=i(0),a=i(7699),r=i(194),s=i(2003),c=i(179),d=i(3441),u=i(53),v=i(1054),l=i(224),h=i(183),p=i(1062),b=new s.a,f=function(){function t(){this.boardOnlineListenerRemove=function(){},this.sessionLeft=new e.Signal,this.dataReceived=new e.Signal,this.watcherSessionData=new Map,this.broadcasterSessionData=new Map,this.sendDataHelper=d.a(this.flushData.bind(this),500)}return t.prototype.connect=function(){var e;null===(e=this.model)||void 0===e||e.connectToBroadcast(),this.broadcasterSessionData.clear(),this.sendDataHelper.start()},t.prototype.startBroadcast=function(){var e;null===(e=this.model)||void 0===e||e.startBroadcast()},t.prototype.stopBroadcast=function(){var e;null===(e=this.model)||void 0===e||e.stopBroadcast()},t.prototype.onCameraModelReady=function(e){this.model&&this.clearCameraModel(),this.model=e,Object(r.a)().currentBoard.permissionsChanged.add(this.onPermissionsChanged,this),this.boardOnlineListenerRemove=v.a.addStateChangeListenerOld("board.online",this.onBoardOnlineChanged)},t.prototype.clearCameraModel=function(){Object(r.a)().currentBoard.permissionsChanged.remove(this.onPermissionsChanged,this),v.a.getSignals().ui.board.screenvideochat.sessionLost({reason:"clearCameraModel"}),this.model=b,this.boardOnlineListenerRemove(),this.boardOnlineListenerRemove=function(){}},t.prototype.flushData=function(){var e=this;this.broadcasterSessionData.forEach((function(t,i){var n=JSON.stringify(t);e.model.updateAttributes(i,n)})),this.broadcasterSessionData.clear()},t.prototype.disconnect=function(){this.model.disconnectedFromBroadcast(),this.broadcasterSessionData.clear(),this.sendDataHelper.stop(),this.sessionLeft.dispatch()},t.prototype.reportUpdatedCursor=function(e,t,i){var n=v.a.getState().ui.board.screenvideochat.broadcaster;n&&n.clientId===e&&v.a.getSignals().ui.board.screenvideochat.broadcasterCursorUpdated({clientId:e,x:t,y:i})},t.prototype.reportDisconnectedWatcher=function(e){v.a.getSignals().ui.board.screenvideochat.participantDisconnected({clientId:e,reason:"reportDisconnectedWatcher"})},t.prototype.reportConnectedWatcher=function(e){var t,i=v.a.getState().user.accounts.map((function(e){return e.id})),n=null===(t=v.a.getState().board.info)||void 0===t?void 0:t.account,o=l.a.getInfo().currentUserContext.role;if(n){var a=i.includes(n.id);(Object(h.isPaidAccount)(n)||Object(p.d)()?a||l.a.getInfo().currentUserContext.role===u.D.EDITOR:a&&o!==u.D.COMMENTATOR&&o!==u.D.VIEWER)&&v.a.getSignals().ui.board.screenvideochat.participantConnected({clientId:e})}},t.prototype.reportAttributesUpdated=function(e,t,i){var o=JSON.parse(i);n.log("scrshr","received",t,o),this.watcherSessionData.set(t,o),this.dataReceived.dispatch(t,o)},t.prototype.reportViewportUpdated=function(e,t,i,n,o){v.a.getSignals().ui.board.screenvideochat.viewportUpdated({clientId:e,x0:t,y0:i,x1:n,y1:o})},t.prototype.reportBroadcastStarted=function(e){v.a.getSignals().ui.board.screenvideochat.broadcastStarted({clientId:e})},t.prototype.reportBroadcastStopped=function(){v.a.getSignals().ui.board.screenvideochat.broadcastStopped()},t.prototype.onPermissionsChanged=function(){a.a()||v.a.getSignals().ui.board.screenvideochat.stopBroadcast()},t.prototype.onBoardOnlineChanged=function(e){e&&v.a.getSignals().ui.board.screenvideochat.sessionLost({reason:"onBoardOnlineChanged"})},t.prototype.getData=function(e){return this.watcherSessionData.get(e)},t.prototype.sendData=function(e,t){n.log("scrshr","send:",e,t),this.broadcasterSessionData.set(e,t),this.sendDataHelper.change()},Object(o.c)([c.j.autobind],t.prototype,"onBoardOnlineChanged",null),t}();t.a=f}).call(this,i(110),i(54))},7699:function(e,t,i){"use strict";i.d(t,"a",(function(){return d}));var n=i(53),o=i(195),a=i(187),r=i(228),s=i(224),c=a.b();function d(){var e=s.a.getInfo();return!!(null===e||void 0===e?void 0:e.currentUserContext)&&function(){var e,t,i=s.a.getInfo();return!!(null===(e=null===i||void 0===i?void 0:i.account)||void 0===e?void 0:e.features)&&i.account.features.includes(o.b.SCREEN_SHARING)&&(c().userType===r.a.GUEST||!!(null===(t=null===i||void 0===i?void 0:i.currentUserContext)||void 0===t?void 0:t.permissions)&&i.currentUserContext.permissions.includes(n.C.USE_SCREEN_SHARING))}()&&e.currentUserContext.role!==n.D.COMMENTATOR&&c().userType!==r.a.GUEST}},7700:function(e,t,i){var n=i(7701);"string"===typeof n&&(n=[[e.i,n,""]]);var o={hmr:!0,transform:undefined,insertInto:void 0};i(178)(n,o);n.locals&&(e.exports=n.locals)},7701:function(e,t,i){(e.exports=i(177)(!1)).push([e.i,".screen-video-chat-toast__circle-icon {\n  color: #ff6575;\n  width: 8px;\n  height: 8px;\n  margin-right: 10px;\n}\n.screen-video-chat-toast__subtitle {\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-align: center;\n      align-items: center;\n}\n.screen-video-chat-toast__user-icon {\n  width: 16px;\n  height: 16px;\n  margin-right: 2px;\n}\n",""])},7702:function(e,t,i){"use strict";(function(e){i.d(t,"a",(function(){return r}));var n=i(182),o=i(200),a=i(11371);function r(){Object(n.b)().component("viewWrapper",Object(o.a)(e)(a.a,[]))}}).call(this,i(111)(e))},7703:function(e,t,i){var n=i(7704);"string"===typeof n&&(n=[[e.i,n,""]]);var o={hmr:!0,transform:undefined,insertInto:void 0};i(178)(n,o);n.locals&&(e.exports=n.locals)},7704:function(e,t,i){(e.exports=i(177)(!1)).push([e.i,".screen-video-chat__bottom-panel {\n  position: absolute;\n  z-index: 95;\n}\n.ss-ui-border-layer {\n  pointer-events: none;\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  border: 2px solid transparent;\n  box-sizing: border-box;\n}\n.ss-ui-border-layer--can-broadcast {\n  border-color: rgba(205, 204, 215, 1);\n  border-color: var(--indigo400);\n}\n.ss-ui-border-layer--broadcasting {\n  border-color: rgba(66, 98, 255, 1);\n  border-color: var(--blue700);\n}\n",""])},7705:function(e,t){e.exports='<div id="board-video-chat-bottom" class="screen-video-chat__bottom-panel" bottom-panel-positioner>\n\t<view-wrapper></view-wrapper>\n</div>\n'}}]);
//# sourceMappingURL=https://miro.com/app/static/ScreenVideoChat.cb6eb90b400b3dda07de.js.map